jQuery(function($){'use strict';const wrapper=$('#gdos_cupon_wrap');if(!wrapper.length)return;const form=$('form.cart');const $checkbox=$('#gdos_cupon_switch');const $visualSwitch=$('#gdos_switch_visual');const $textLabel=$('#gdos_switch_label');const $msg=$('#gdos_cupon_msg');const $btn=form.find('button.single_add_to_cart_button');const config=window.gdosCuponSwitch||{};let currentVariationId=0;if(!$btn.data('original-html')){$btn.data('original-html',$btn.html())}
const lockButton=()=>{$btn.html('YA EN CARRITO').prop('disabled',!0).addClass('gdos-btn-disabled')};const unlockButton=()=>{$btn.html($btn.data('original-html')||'Agregar al carrito').prop('disabled',!1).removeClass('gdos-btn-disabled')};const setOnUI=(mode)=>{$visualSwitch.addClass('is-on');if(mode==='added'){$textLabel.text(config.txt_on_added);lockButton()}else{$textLabel.text(config.txt_on_global);unlockButton()}};const setOffUI=()=>{$visualSwitch.removeClass('is-on');$textLabel.text(config.txt_off);unlockButton()};const setLoadingUI=(isLoading)=>{$checkbox.prop('disabled',isLoading);$visualSwitch.css('cursor',isLoading?'wait':'pointer');wrapper.css('opacity',isLoading?'0.7':'1')};const isProductInCart=wrapper.attr('data-in-cart')==='yes';if($checkbox.is(':checked')){setOnUI(isProductInCart?'added':'global')}else{setOffUI()}
form.on('found_variation',function(event,variation){currentVariationId=variation.variation_id});form.on('reset_data',function(){currentVariationId=0});$checkbox.on('change',function(){const isOn=$(this).is(':checked');setLoadingUI(!0);$msg.hide();if(isOn){const data={action:'cupon_aplicar_y_agregar',nonce:config.nonce,cupon:'primeracompra',quantity:form.find('input.qty').val()||1,product_id:config.product_id,variation_id:currentVariationId||form.find('input[name="variation_id"]').val()||0};form.find('select[name^="attribute_"], input[name^="attribute_"]').each(function(){data[this.name]=$(this).val()});$.post(config.ajaxurl,data,function(response){if(response&&response.success){wrapper.attr('data-in-cart','yes');setOnUI('added');$(document.body).trigger('wc_fragment_refresh')}else{alert((response&&response.data)||'No se pudo aplicar el cupón.');$checkbox.prop('checked',!1);setOffUI()}}).fail(()=>{alert('Error de conexión. Intente nuevamente.');$checkbox.prop('checked',!1);setOffUI()}).always(()=>{setLoadingUI(!1)})}else{const data={action:'cupon_remover',nonce:config.nonce,cupon:'primeracompra'};$.post(config.ajaxurl,data,function(response){if(response&&response.success){setOffUI();$msg.text(config.txt_removed).fadeIn();$(document.body).trigger('wc_fragment_refresh')}else{alert((response&&response.data)||'No se pudo remover el cupón.');$checkbox.prop('checked',!0);const currentInCart=wrapper.attr('data-in-cart')==='yes';setOnUI(currentInCart?'added':'global')}}).fail(()=>{$checkbox.prop('checked',!0);const currentInCart=wrapper.attr('data-in-cart')==='yes';setOnUI(currentInCart?'added':'global')}).always(()=>{setLoadingUI(!1)})}})})
;